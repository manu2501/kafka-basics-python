<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burger Kiosk</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .burger-card {
            transition: transform 0.2s;
            margin-bottom: 20px;
        }

        .burger-card:hover {
            transform: translateY(-5px);
        }

        .order-summary {
            position: sticky;
            top: 20px;
        }

        .quantity-input {
            width: 60px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">üçî Burger Kiosk</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Menu Section -->
            <div class="col-md-8">
                <h2>Menu</h2>
                <div class="row" id="menu-container"></div>
            </div>

            <!-- Order Section -->
            <div class="col-md-4">
                <div class="card order-summary">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">Your Order</h3>
                    </div>
                    <div class="card-body">
                        <form id="order-form">
                            <div class="mb-3">
                                <label for="customer-name" class="form-label">Your Name</label>
                                <input type="text" class="form-control" id="customer-name" required>
                            </div>
                            <div id="order-items" class="mb-3">
                                <!-- Order items will be listed here -->
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <h5>Total:</h5>
                                <h5>$<span id="total-amount">0.00</span></h5>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Place Order</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Success Modal -->
    <div class="modal fade" id="orderModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Order Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modal-message"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Store menu items globally
        let menuItems = [];
        let orderItems = new Map(); // Map to store burger_id -> quantity

        // Fetch menu when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('http://localhost:8000/menu');
                menuItems = await response.json();
                displayMenu(menuItems);
            } catch (error) {
                console.error('Error fetching menu:', error);
                alert('Failed to load menu. Please try again later.');
            }
        });

        function displayMenu(items) {
            const container = document.getElementById('menu-container');
            container.innerHTML = items.map(burger => `
                <div class="col-md-6">
                    <div class="card burger-card">
                        <div class="card-body">
                            <h5 class="card-title">${burger.name}</h5>
                            <p class="card-text">${burger.description}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">$${burger.price.toFixed(2)}</h6>
                                <div class="input-group" style="width: 120px;">
                                    <button class="btn btn-outline-secondary" type="button" 
                                            onclick="updateQuantity(${burger.id}, -1)">-</button>
                                    <input type="number" class="form-control text-center quantity-input" 
                                           id="quantity-${burger.id}" value="0" min="0" 
                                           onchange="updateOrderFromInput(${burger.id}, this.value)">
                                    <button class="btn btn-outline-secondary" type="button" 
                                            onclick="updateQuantity(${burger.id}, 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateQuantity(burgerId, change) {
            const input = document.getElementById(`quantity-${burgerId}`);
            const newValue = Math.max(0, parseInt(input.value || 0) + change);
            input.value = newValue;
            updateOrder(burgerId, newValue);
        }

        function updateOrderFromInput(burgerId, value) {
            const quantity = Math.max(0, parseInt(value || 0));
            document.getElementById(`quantity-${burgerId}`).value = quantity;
            updateOrder(burgerId, quantity);
        }

        function updateOrder(burgerId, quantity) {
            if (quantity > 0) {
                orderItems.set(burgerId, quantity);
            } else {
                orderItems.delete(burgerId);
            }
            updateOrderSummary();
        }

        function updateOrderSummary() {
            const orderContainer = document.getElementById('order-items');
            let total = 0;

            const orderHtml = Array.from(orderItems.entries()).map(([burgerId, quantity]) => {
                const burger = menuItems.find(b => b.id === burgerId);
                const itemTotal = burger.price * quantity;
                total += itemTotal;
                return `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            ${burger.name} x ${quantity}
                        </div>
                        <div>$${itemTotal.toFixed(2)}</div>
                    </div>
                `;
            }).join('');

            orderContainer.innerHTML = orderHtml || '<p class="text-muted">No items in order</p>';
            document.getElementById('total-amount').textContent = total.toFixed(2);
        }

        // Handle order submission
        document.getElementById('order-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (orderItems.size === 0) {
                alert('Please add at least one item to your order');
                return;
            }

            const customerName = document.getElementById('customer-name').value.trim();
            if (!customerName) {
                alert('Please enter your name');
                return;
            }

            const orderData = {
                customer_name: customerName,
                items: Array.from(orderItems.entries()).map(([burger_id, quantity]) => ({
                    burger_id: burger_id,
                    quantity: quantity
                }))
            };

            try {
                const response = await fetch('http://localhost:8000/order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                const result = await response.json();

                if (response.ok) {
                    // Show success modal
                    const modal = new bootstrap.Modal(document.getElementById('orderModal'));
                    document.getElementById('modal-message').innerHTML = `
                        <div class="alert alert-success">
                            <h4>Order Placed Successfully!</h4>
                            <p>Order ID: ${result.order_id}</p>
                            <p>${result.message}</p>
                            <p>Estimated wait time: ${result.estimated_wait_time} minutes</p>
                        </div>
                    `;
                    modal.show();

                    // Clear the form
                    orderItems.clear();
                    document.getElementById('customer-name').value = '';
                    document.querySelectorAll('.quantity-input').forEach(input => input.value = 0);
                    updateOrderSummary();
                } else {
                    throw new Error(result.detail || 'Failed to place order');
                }
            } catch (error) {
                console.error('Error placing order:', error);
                alert('Failed to place order: ' + error.message);
            }
        });
    </script>
</body>

</html>

</html>
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>User Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <h1 class="mb-4">Burger Kiosk - User Dashboard</h1>
      <div id="menu" class="row g-3"></div>
      <hr />
      <h3>Cart</h3>
      <ul id="cart" class="list-group mb-3"></ul>
      <div class="mb-3">
        <input id="customer" class="form-control" placeholder="Your name" />
      </div>
      <button id="placeOrder" class="btn btn-primary">Place Order</button>
      <div id="result" class="mt-3"></div>
    </div>
    <script>
      const menuEl = document.getElementById('menu');
      const cartEl = document.getElementById('cart');
      const customerEl = document.getElementById('customer');
      const resultEl = document.getElementById('result');
      const cart = new Map();

      fetch('menu').then(r=>r.json()).then(items => {
        items.forEach(item => {
          const col = document.createElement('div');
          col.className = 'col-md-4';
          col.innerHTML = `
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">${item.name}</h5>
                <p class="card-text">${item.description}</p>
                <p class="card-text fw-bold">$${item.price.toFixed(2)}</p>
                <button class="btn btn-sm btn-outline-primary">Add</button>
              </div>
            </div>
          `;
          col.querySelector('button').onclick = () => {
            cart.set(item.id, (cart.get(item.id) || 0) + 1);
            renderCart();
          };
          menuEl.appendChild(col);
        });
      });

      function renderCart() {
        cartEl.innerHTML = '';
        for (const [burger_id, quantity] of cart.entries()) {
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.textContent = `Item #${burger_id}`;
          const badge = document.createElement('span');
          badge.className = 'badge bg-primary rounded-pill';
          badge.textContent = quantity;
          li.appendChild(badge);
          cartEl.appendChild(li);
        }
      }

      document.getElementById('placeOrder').onclick = async () => {
        const items = Array.from(cart.entries()).map(([burger_id, quantity]) => ({ burger_id, quantity }));
        const customer_name = customerEl.value || 'Guest';
        const res = await fetch('order', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ items, customer_name })});
        const data = await res.json();
        resultEl.textContent = res.ok ? `Order ${data.order_id} accepted! ETA: ${data.estimated_wait_time} min` : `Error: ${data.detail || 'Unknown'}`;
      };
    </script>
  </body>
</html>
